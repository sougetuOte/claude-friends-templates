# エージェントシステム - マルチエージェントAI開発

🌐 **[English](README.md)** | **日本語**

このディレクトリには、claude-friends-templatesマルチエージェントシステムのエージェント定義と設定が含まれています。エージェントは協働して戦略計画、実装、テスト、品質保証機能を提供します。

## 📁 ディレクトリ構造

```
agents/
├── 設定ファイル
│   ├── active.json           # 現在のアクティブエージェント追跡
│   └── active.md             # 人間が読めるアクティブエージェント状態
│
├── コアエージェント
│   ├── first.md              # エントリーポイントエージェント（非推奨）
│   ├── sync-specialist.md    # 状態同期スペシャリスト
│   ├── test-writer.md        # テスト駆動開発スペシャリスト
│   └── security-auditor.md   # セキュリティ分析スペシャリスト
│
└── エージェントワークスペース（親ディレクトリに配置）
    ├── ../planner/           # Plannerエージェントワークスペース
    └── ../builder/           # Builderエージェントワークスペース
```

## 🤖 エージェントエコシステム

### コアエージェントの役割

#### 🎯 Plannerエージェント (`../planner/`)
**専門分野**: 戦略的思考とアーキテクチャ設計
**機能**:
- 要件分析と明確化
- システムアーキテクチャ設計
- プロジェクト計画とタスク分解
- リスク評価と緩和戦略
- 技術スタック推奨

**性格**: 思慮深い、系統的、大局的視点
**使用場面**: 戦略計画、設計決定、プロジェクト構造化が必要な時

#### 🔨 Builderエージェント (`../builder/`)
**専門分野**: 実装とハンズオン開発
**機能**:
- コード実装とデバッグ
- テスト駆動開発実行
- リファクタリングと最適化
- 統合とデプロイメント
- 技術的問題のトラブルシューティング

**性格**: 実用的、詳細指向、行動重視
**使用場面**: コーディング、テスト、技術実装が必要な時

#### 🔄 Sync Specialist (`sync-specialist.md`)
**専門分野**: エージェント間通信と状態管理
**機能**:
- ハンドオーバードキュメント生成
- エージェント切り替え間のコンテキスト保持
- 状態同期検証
- TDDフェーズ追跡と管理
- エージェント遷移の品質保証

**性格**: 細心、系統的、連携重視
**使用場面**: エージェント切り替え時に自動的に有効化

#### ✅ Test Writer (`test-writer.md`)
**専門分野**: テスト駆動開発と品質保証
**機能**:
- テスト戦略設計と実装
- TDD Red-Green-Refactorサイクル管理
- 品質ゲート強制
- テストカバレッジ分析
- 自動テストフレームワークセットアップ

**性格**: 品質重視、系統的、徹底的
**使用場面**: TDD実装や品質保証が必要な時

#### 🛡️ Security Auditor (`security-auditor.md`)
**専門分野**: セキュリティ分析と脆弱性評価
**機能**:
- セキュリティ脆弱性スキャン
- コードセキュリティレビュー
- コンプライアンスチェック
- セキュリティベストプラクティス実装
- 脅威モデリングとリスク評価

**性格**: 慎重、徹底的、セキュリティ意識
**使用場面**: セキュリティ分析やコンプライアンスチェックが必要な時

## 🔄 エージェント連携

### エージェント切り替え

エージェントはコマンドで切り替え：

```bash
# 戦略作業のためPlannerに切り替え
/agent:planner

# 実装のためBuilderに切り替え
/agent:builder

# Sync Specialistの手動有効化（通常は自動）
/agent:sync-specialist

# TDD重視のためTest Writerを有効化
/agent:test-writer

# セキュリティレビューのためSecurity Auditorを有効化
/agent:security-auditor
```

### 状態管理

#### 現在のエージェント追跡
- **`active.json`**: 機械可読な現在のエージェント状態
- **`active.md`**: 人間が読める現在のエージェント状態
- **自動更新**: 全エージェント切り替え時に更新

#### ハンドオーバープロセス
1. **切り替え前**: 現在のエージェントが作業と決定を要約
2. **状態キャプチャ**: Sync Specialistが現在のコンテキストをキャプチャ
3. **ハンドオーバー生成**: 包括的なハンドオーバードキュメントを作成
4. **切り替え後**: 新しいエージェントが完全なコンテキストを受信
5. **検証**: Sync Specialistが成功した遷移を検証

### コンテキスト保持

#### 保持される内容
- **現在のTDDフェーズ**（🔴 Red → 🟢 Green → 🔵 Refactor）
- **最近のファイル変更**とその目的
- **設計決定**と理由
- **テスト状態**とカバレッジ
- **既知の問題**とブロッカー
- **次のステップ**と優先度

#### メモリーバンク統合
- **共有知識**: 全エージェントが`/memo/`階層にアクセス
- **エージェント固有ノート**: 各エージェントが専門ノートを維持
- **エージェント間学習**: エージェント切り替え間で洞察を共有

## 📋 エージェント設定

### エージェント定義形式

各エージェントはフロントマターとマークダウンで定義：

```markdown
---
name: agent-name
description: エージェント機能の簡潔な説明
tools: Read, Write, MultiEdit, Grep, Bash
personality: 性格特性と作業スタイル
specialties: [専門分野, リスト]
---

# エージェント名

## 役割
エージェントの役割と責任の詳細説明。

## コア責任
- 責任1
- 責任2

## 作業スタイル
エージェントの問題へのアプローチ方法の説明。
```

### アクティブエージェント設定（`active.json`）

```json
{
  "current_agent": "none",
  "last_switch": "2025-07-27T10:30:00Z",
  "switch_count": 0,
  "session_start": "2025-07-27T10:00:00Z",
  "handover_status": "complete"
}
```

## 🚀 使用パターン

### 典型的な開発ワークフロー

#### 1. プロジェクト開始
```bash
/agent:planner
# 戦略計画、要件分析、アーキテクチャ設計
```

#### 2. 実装フェーズ
```bash
/agent:builder
# コーディング、テスト、デバッグ、技術実装
```

#### 3. 品質保証
```bash
/agent:test-writer
# TDD実装、テストカバレッジ改善
```

#### 4. セキュリティレビュー
```bash
/agent:security-auditor
# セキュリティ分析、脆弱性評価
```

#### 5. 反復開発
必要に応じてエージェントを切り替え、自動状態同期を実行。

### 専門ワークフロー

#### TDD重視開発
1. **Planner**: テスト戦略設計
2. **Test Writer**: テストフレームワーク実装
3. **Builder**: Red-Green-Refactorサイクル
4. **Sync Specialist**: TDDフェーズ遷移追跡

#### セキュリティファースト開発
1. **Security Auditor**: 初期脅威モデリング
2. **Planner**: セキュリティ対応アーキテクチャ
3. **Builder**: セキュア実装
4. **Security Auditor**: 継続的セキュリティ検証

## 🔧 カスタマイズ

### 新しいエージェントの追加

1. **エージェント定義作成** `agents/new-agent.md`に：
```markdown
---
name: new-agent
description: エージェント説明
tools: 必要なツール
---

# 新しいエージェント

## 役割
エージェントの役割と責任
```

2. **コマンド定義追加** `../commands/`に：
```markdown
# /agent:new-agent

専門タスクのために新しいエージェントを有効化します。
```

3. **アクティブエージェント追跡更新** 自動化スクリプトで

4. **ワークスペース作成** 必要に応じて（例：`../new-agent/`）

### 既存エージェントの拡張

#### 機能追加
エージェント定義ファイルを修正して新しい責任とツールを含める。

#### 性格調整
進化する作業スタイルを反映するよう性格説明を更新。

#### ツール統合
機能拡張に応じてエージェント定義に新しいツールを追加。

## 🧪 エージェントシステムテスト

### エージェント切り替えテスト
```bash
# エージェント切り替え機能をテスト
.claude/tests/bats/test_agent_switch.bats

# ハンドオーバー生成をテスト
.claude/tests/bats/test_handover_gen.bats
```

### 統合テスト
```bash
# マルチエージェントワークフローをテスト
.claude/tests/e2e/test_e2e_phase1.bats

# 状態保持をテスト
.claude/tests/integration/test_agent_coordination.bats
```

### パフォーマンステスト
```bash
# エージェント切り替えパフォーマンスをベンチマーク
.claude/tests/performance/benchmark-agent-switches.sh
```

## 📊 監視と分析

### エージェント使用メトリクス
- **切り替え頻度**: エージェントが切り替えられる頻度
- **セッション期間**: 各エージェントで過ごす時間
- **ハンドオーバー品質**: コンテキスト保持の成功率
- **TDDコンプライアンス**: TDD原則への遵守

### 品質メトリクス
- **コンテキスト保持スコア**: コンテキストがどの程度維持されるか
- **決定トレーサビリティ**: 設計決定の追跡
- **テストカバレッジ**: 切り替え間で維持されるカバレッジ
- **エラー率**: エージェント連携問題の頻度

## 🔍 デバッグ

### よくある問題

#### エージェント切り替え失敗
**症状**: エージェント切り替えコマンドが動作しない
**デバッグ**:
```bash
# アクティブエージェント状態を確認
cat .claude/agents/active.json

# 最近のハンドオーバーを確認
ls -la .claude/shared/handover/

# エージェント定義を確認
ls -la .claude/agents/
```

#### コンテキスト損失
**症状**: 新しいエージェントに前のエージェントからのコンテキストがない
**デバッグ**:
```bash
# ハンドオーバー生成ログを確認
tail -f ~/.claude/handover-gen.log

# ハンドオーバー内容を確認
cat .claude/shared/handover/handover-latest.md

# Sync Specialistログを確認
tail -f ~/.claude/sync-specialist.log
```

#### TDDフェーズの不整合
**症状**: TDDフェーズ追跡が一貫していない
**デバッグ**:
```bash
# TDDフェーズ状態を確認
grep "TDD Phase" .claude/shared/handover/handover-*.md

# テスト状態を確認
.claude/scripts/tdd-check.sh
```

### デバッグコマンド
```bash
# 現在のエージェント状態を表示
cat .claude/agents/active.md

# 最近のハンドオーバーをリスト
ls -lt .claude/shared/handover/ | head -10

# エージェント連携ログを確認
tail -f ~/.claude/agent-coordination.log
```

## 📚 ベストプラクティス

### エージェント使用ガイドライン

1. **タスクに適切なエージェント**: 必要な作業の種類に基づいてエージェントを選択
2. **明確なハンドオーバー**: 切り替え時に包括的なコンテキストを確保
3. **TDD遵守**: 切り替え間でTDDフェーズの整合性を維持
4. **定期同期**: 複雑な遷移にはSync Specialistを使用
5. **品質ゲート**: レビューには品質重視エージェントを活用

### 開発ワークフロー

1. **戦略的に開始**: 大局的思考のためPlannerで始める
2. **段階的実装**: 集中実装のためBuilderを使用
3. **継続的テスト**: 品質保証のためTest Writerを統合
4. **定期レビュー**: 定期レビューにSecurity Auditorを使用
5. **決定文書化**: 明確な決定の軌跡を維持

### 状態管理

1. **コンテキスト保持**: すべての関連コンテキストがキャプチャされることを確保
2. **決定追跡**: なぜ決定がなされたかを文書化
3. **継続性維持**: エージェント間で作業がスムーズに流れるよう維持
4. **遷移検証**: 複雑なハンドオーバーにはSync Specialistを使用

## 🔗 統合ポイント

### フックシステムとの統合
- **エージェント切り替えフック**: 自動ハンドオーバー生成
- **状態検証フック**: コンテキスト保持検証
- **品質ゲート**: 切り替え時の自動品質チェック

### メモリーバンクとの統合
- **共有知識**: すべてのエージェントが共通メモリにアクセス
- **専門ノート**: エージェント固有の知識領域
- **歴史的コンテキスト**: 以前のエージェント決定と理由

### テストフレームワークとの統合
- **TDD追跡**: エージェント間でのフェーズ対応テスト
- **品質メトリクス**: テストカバレッジと品質維持
- **自動検証**: 継続的品質保証

---

**注意**: エージェントシステムは開発ニーズに進化・適応するよう設計されています。要件変更に応じてエージェントをカスタマイズ、拡張、新規追加できます。重要なのは、すべてのエージェント相互作用で効果的な連携とコンテキスト保持を維持することです。
