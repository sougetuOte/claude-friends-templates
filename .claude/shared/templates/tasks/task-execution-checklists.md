# タスク実行チェックリスト（統合版）

claude-kiro-templateのTask Execution Checklistsとclaude-friends-templatesのTDD手法を統合したガイドです。

## 📋 Pre-Task Checklist（タスク開始前）

### 要件・設計確認
- [ ] タスク要件を完全に理解している
- [ ] 依存関係を特定し、利用可能である
- [ ] 設計との整合性を確認した
- [ ] requirements.mdとdesign.mdを参照した
- [ ] 成功基準が明確に定義されている

### TDD準備
- [ ] テストシナリオを計画した（ハッピーパス、エッジケース、エラー）
- [ ] テストファイルの配置場所を決めた
- [ ] 必要なツールとライブラリが利用可能
- [ ] テスト環境が準備されている

### 設計確認
- [ ] 設計ドキュメントの最新版を確認
- [ ] アーキテクチャパターンを理解
- [ ] インターフェース定義を確認
- [ ] 非機能要件を理解

## 🔄 During-Task Checklist（実行中）

### TDD厳守
- [ ] **Red Phase**: 失敗するテストを先に書いた
- [ ] テストが期待通りの理由で失敗することを確認
- [ ] **Green Phase**: 最小限の実装でテストを通した
- [ ] **Design Check**: 実装が設計に準拠していることを確認
- [ ] **Refactor Phase**: テストを通した状態でコード品質を向上

### コード品質
- [ ] TDDサイクルに厳密に従っている
- [ ] 説明的なテスト名を書いている
- [ ] コードが設計基準を満たしている
- [ ] エラーハンドリングを実装している
- [ ] デバッグ用ログを追加している
- [ ] パフォーマンスへの影響を考慮している

### 設計同期
- [ ] 実装中に設計の問題を発見した場合、即座に記録
- [ ] 設計変更が必要な場合、Plannerにエスカレーション
- [ ] アーキテクチャ違反がないか確認
- [ ] SOLID原則に準拠

## ✅ Post-Task Checklist（完了後）

### テスト・品質確認
- [ ] すべてのテストがパスしている
- [ ] コードカバレッジが基準を満たしている（≥80%）
- [ ] コード品質をレビューした
- [ ] 統合テストが通っている
- [ ] パフォーマンステストが必要な場合実行

### ドキュメント更新
- [ ] 実装に関するドキュメントを更新
- [ ] 設計ドキュメントと同期
- [ ] APIドキュメントを更新（該当する場合）
- [ ] READMEを必要に応じて更新
- [ ] 実装ノートを履歴に追加

### タスク管理
- [ ] タスクステータスをphase-todo.mdで更新（🔴→🟢→✅）
- [ ] builder/notes.mdに作業記録
- [ ] handover.mdに引き継ぎ事項記載（必要時）
- [ ] ブロッカーや課題があれば記録

### コミット・プッシュ
- [ ] 適切なコミットメッセージでコミット
  - Red Phase: `test: add failing test for [feature]`
  - Green Phase: `feat: implement [feature] to pass test`  
  - Refactor Phase: `refactor: [description]`
- [ ] コミット前にpre-commitフックが通る
- [ ] プッシュ前にCI/CDが通ることを確認

## 🔄 TDD拡張サイクル（統合版）

### 1. 観察 (Observe)
- task.mdから最優先の🔴タスクを選択
- ブロック中⚠️タスクの解除確認

### 2. 設計確認 (Design Check)
- 選択タスクがdesign.mdと整合しているか確認
- 依存関係の満足度確認
- 実装アプローチがアーキテクチャに従っているか確認

### 3. 計画 (Plan)
- タスクを具体的なマイクロステップに分解
- TDD手法適用: Red → Green → Design Check → Refactor

### 4. 実行 (Act) - TDD Implementation
#### 4.1 🔴 Red Phase
- 失敗するテストを先に書く
- テストが正しい理由で失敗することを確認
- テストの説明で期待動作を文書化

#### 4.2 🟢 Green Phase  
- テストを通すための最小限のコードを書く
- テストを通すことのみに集中
- この段階での過度な設計は避ける

#### 4.3 🔍 Design Check Phase（kiro-template流）
- 実装がdesign.mdと整合していることを確認
- アーキテクチャ違反がないかチェック
- 意図しない副作用がないことを確認

#### 4.4 🔵 Refactor Phase
- テストを通した状態でコード品質を向上
- SOLID原則とクリーンコードの実践
- 必要に応じてドキュメント更新

### 5. 設計同期 (Design Sync)
実装で設計のギャップや改善が明らかになった場合：

#### 設計競合解決フレームワーク
1. **競合の評価**:
   - 設計の詳細が不足している？
   - 設計に欠陥がある？
   - 実装が設計から逸脱している？

2. **決定基準**:
   - 設計が不完全 → design.mdに詳細追加
   - 設計に欠陥 → design.mdを改善
   - 実装が逸脱 → 設計に合わせて実装修正

3. **文書化要件**:
   - design.mdの変更を文書化
   - 変更理由を含める
   - 影響を受けるコンポーネントを更新
   - 設計変更ログにエントリ追加

**重要**: 設計更新を延期しない。即座の同期が必須。

### 6. 自己修正 (Self-Correct)
- **テスト成功時**:
  1. タスクを🟢（最小実装完了）に更新
  2. 可読性・効率性のためのリファクタリングを検討
  3. リファクタリング後、✅（リファクタリング完了）に更新
  4. 実装詳細を実装履歴に文書化

- **テスト失敗時**:
  1. エラーメッセージ、ログ、関連コードを分析
  2. バグ原因の仮説を立てる
  3. 仮説に基づいてコードを修正し再テスト
  4. 3回試行で未解決の場合:
     - ⚠️（ブロック中）としてマーク
     - ブロックタスクセクションに文書化:
       - 失敗ログ
       - 試行した解決策
       - 疑われる根本原因
     - ステップ1に戻り他のタスクを選択

## 🎯 指導原則（Guiding Principles）

- **真実の源**: requirements.mdとdesign.mdは絶対的なガイドライン
- **クリーンコード**: 常に読みやすく保守可能なコードを維持
- **漸進的進歩**: タスク単位で小さく確実なコミットを実行
- **設計ファースト**: すべての実装は設計と整合し、設計を強化する必要
- **即座同期**: 設計と実装は同期状態を維持
- **トレーサビリティ**: すべての決定と変更は文書化する必要

## 🚨 品質ゲート

### Critical（クリティカル） - 必須
- [ ] すべてのテストがパス
- [ ] 設計との整合性確認
- [ ] セキュリティ脆弱性なし
- [ ] パフォーマンス劣化なし

### High（高） - 強く推奨
- [ ] コードカバレッジ80%以上
- [ ] コード複雑度基準以下
- [ ] ドキュメント更新済み
- [ ] リファクタリング完了

### Medium（中） - 推奨
- [ ] コメント適切
- [ ] 命名規則遵守
- [ ] ログ適切
- [ ] エラーハンドリング完備

## 関連ドキュメント

- **TDDサイクル実践**: `.claude/builder/tdd-cycle.md`
- **テスト構造ガイド**: `.claude/shared/templates/test-structure-guide.md`
- **設計同期**: `.claude/shared/design-sync.md`
- **タスクステータス管理**: `.claude/shared/task-status.md`
- **TDD設定**: `.claude/shared/tdd-settings.md`

---
*品質はプロセスから生まれる。チェックリストはそのプロセスを支える基盤。*