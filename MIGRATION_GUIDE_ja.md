# Claude Friends 移行ガイド

🌐 **日本語** | **[English](MIGRATION_GUIDE.md)**

Claude Friends Templatesの最新バージョンへの移行を包括的にサポートするガイドです。

## 📌 最新バージョン: v2.5.0（2025年9月17日）

### 🎯 あなたに最適な移行パスを選択

#### 新規ユーザーの方へ
**[Getting Started Guide](GETTING_STARTED.md)** から始めてください - 初心者向けに特別に設計されています。

#### 既存ユーザーの方へ
あなたの快適なレベルを選択してください：
- **保守的アプローチ**: まずは最小限の機能から試す（15分）
- **段階的アプローチ**: 1-2週間かけて機能を段階的に採用
- **包括的アプローチ**: すべての機能を含む完全移行

---

## 🌟 v2.5.0の新機能 - Phase 2拡張

### インテリジェント自動化
- **スマートMemory Bank**: 重要度スコアリング（0-100）による自動ローテーション
- **並列処理**: 最大10個のサブエージェントの同時実行
- **TDD強制**: t-wada式テスト駆動開発の検証
- **高度な監視**: Prometheus形式のメトリクスとAI最適化ログ

### 段階的学習パス
- **最小構成**: `settings-minimal.json`を使用して2つのコマンドから開始
- **段階的拡張**: 慣れるにつれて機能をアンロック
- **フルパワーモード**: `settings-full.json`ですべてにアクセス

---

## 🚀 v2.4.x から v2.5.0 への移行

### オプション1: 最小限から始める（推奨）

#### ステップ1: 現在の構成をバックアップ
```bash
# 必ず最初にバックアップを作成
tar -czf claude-backup-$(date +%Y%m%d).tar.gz .claude/
```

#### ステップ2: 最小構成を取得
```bash
# 最小設定をダウンロード（エージェント切り替え + セキュリティのみ）
curl -o .claude/settings-minimal.json \
  https://raw.githubusercontent.com/sougetuOte/claude-friends-templates/v2.5.0/.claude/settings-minimal.json

# 1週間試してみる
cp .claude/settings-minimal.json .claude/settings.json
```

#### ステップ3: コア機能のみを使用
```bash
/agent:planner  # 計画と設計
/agent:builder  # 実装
# それだけです！他はすべて自動的に動作します
```

### オプション2: 段階的採用（1-2週間）

#### 第1週: コア機能
- 自動引き継ぎ付きエージェント切り替え
- セキュリティコマンドブロック
- 最小構成

#### 第2週: 便利機能
- Memory Bank自動ローテーションを体験
- AI駆動エラー分析を試す
- 同じ2つのコマンドを使い続ける

#### 第3週以降: 高度な機能（必要に応じて）
```bash
# すべての準備ができましたか？
cp .claude/settings-full.json .claude/settings.json
```

### オプション3: 完全移行（上級ユーザー向け）

#### 前提条件
- v2.4.0のすべての機能に習熟している
- チームが並列処理やTDD強制を必要としている
- メトリクスを必要とする本番環境

#### 完全移行手順
```bash
# 1. すべてのv2.5.0構成を取得
git pull origin main

# 2. フル設定をコピー
cp .claude/settings-full.json .claude/settings.json

# 3. すべてのフックスクリプトをインストール
chmod +x .claude/hooks/**/*.sh
chmod +x .claude/scripts/*.sh

# 4. インストールを確認
.claude/scripts/test-hooks.sh
```

---

## 📊 機能採用ガイド

### 必須機能（ここから始める）
| 機能 | 目的 | 使用タイミング |
|------|------|-------------|
| エージェント切り替え | 自動的な役割管理 | 常時 |
| 自動引き継ぎ | コンテキスト保持 | 常時 |
| セキュリティブロック | 危険なコマンドを防止 | 常時 |

### 便利機能（第2週以降）
| 機能 | 目的 | 使用タイミング |
|------|------|-------------|
| Memory Bankローテーション | スマートなnotes管理 | notes.mdが500行を超えた時 |
| AIログ分析 | 高速デバッグ | エラー発生時 |
| 重要度スコアリング | 重要情報の保持 | 自動 |

### 高度な機能（オプション）
| 機能 | 目的 | 使用タイミング |
|------|------|-------------|
| 並列実行 | 複数タスク処理 | 大規模プロジェクト |
| TDD強制 | 品質ゲート | チーム開発 |
| メトリクス監視 | システム可観測性 | 本番環境 |

---

## 🔄 旧バージョンからの移行

### v2.4.0 → v2.5.0
上記の詳細手順を参照してください。主な追加機能：
- Phase 2拡張機能
- 段階的学習パスサポート
- パフォーマンス最適化

### v2.0.0 → v2.5.0
1. まずv2.4.0に移行（下記セクション参照）
2. その後、上記のv2.5.0移行手順に従う

### v1.x → v2.5.0
1. まずv2.0.0移行を完了
2. その後、v2.5.0への段階的パスに従う

---

## 📌 前バージョン: v2.4.0

### 🚀 v2.4.0の新機能

#### Agent-First開発システム
- **エントリーポイント**: `/agent:first` - 開発方法論ガイド
- **強制フロー**: 要件 → 設計 → タスク → 実装
- **品質ゲート**: 各段階での自動検証
- **ステージガード**: 進行前の完全性チェック

#### 強化されたセキュリティシステム
- **100%検出率**: すべての危険なコマンドをブロック
- **拡張パターン**: 10以上のカテゴリの危険コマンド
- **セキュリティ監査**: 包括的なスキャンツール

#### コードインフラストラクチャ
- **共有ユーティリティ**: `.claude/scripts/shared-utils.sh`
- **30%のコード削減**: リファクタリングスクリプトで実証
- **標準化された操作**: 統一されたロギングとユーティリティ

---

## 🎉 v2.0.0の革命的変更

### Claude Friendsマルチエージェントシステムの導入
- **Plannerエージェント**: 戦略立案・設計書作成（Mermaid図付き）
- **Builderエージェント**: 実装・デバッグ・コードレビュー
- **スマートモード切り替え**: エージェントが文脈に応じて自動的に特殊モードに切り替え

### コマンドの簡素化
- **以前**: 7つ以上のコマンド
- **現在**: 4つのコアコマンド
- **変更**: コマンド数の削減と統合

## 🚨 破壊的変更履歴

### v2.0.0の破壊的変更

| 廃止されたコマンド | 新しい方法 |
|-------------------|------------|
| `/project:plan` | `/agent:planner` を使用 |
| `/project:act` | `/agent:builder` を使用 |
| `/feature:plan` | Plannerの新機能設計モード（自動） |
| `/debug:start` | Builderのデバッグモード（自動） |
| `/review:check` | Builderのコードレビューモード |


---

## ⚡ クイック回復オプション

### 前バージョンへのロールバック
```bash
# 最小構成へのクイックロールバック
cp .claude/settings-minimal.json .claude/settings.json

# バックアップからの完全ロールバック
rm -rf .claude
tar -xzf claude-backup-*.tar.gz
```

### 機能の選択的無効化
```json
// .claude/settings.json で不要な機能をコメントアウト
{
  "hooks": {
    "UserPromptSubmit": [
      // 必要なものだけを残す
      {
        "matcher": "/agent:",
        "command": ".claude/hooks/agent/agent-switch.sh"
      }
    ]
    // 高度な機能をコメントアウト
    // "PostToolUse": [...]
  }
}
```

---

## 📋 移行チェックリスト

### v2.5.0移行
- [ ] 現在の構成のバックアップを作成
- [ ] [Getting Started Guide](GETTING_STARTED.md)を確認
- [ ] 移行アプローチを選択（最小限/段階的/完全）
- [ ] settings-minimal.jsonでテスト
- [ ] ロールバック手順を理解
- [ ] [README](README.md)で新機能について読む

### コア機能テスト
- [ ] `/agent:planner` が正しく切り替わる
- [ ] `/agent:builder` が正しく切り替わる
- [ ] Handover.mdが自動生成される
- [ ] セキュリティブロックが機能する
- [ ] 基本的なワークフローが変更されていない

### 段階的機能テスト
- [ ] Memory Bankローテーションが500行でトリガー
- [ ] AIログがJSONL形式で生成される
- [ ] エラー分析がインサイトを提供
- [ ] パフォーマンスが許容範囲内

---

## ❓ よくある質問

### Q: v2.5.0は既存のワークフローを壊しますか？
**A:** いいえ。`settings-minimal.json`を使用すると、自動引き継ぎとセキュリティが追加された同じワークフローになります。他の機能はオプションです。

### Q: 移行にはどれくらい時間がかかりますか？
**A:**
- 最小限: 15分
- 段階的: 1-2週間の段階的採用
- 完全: 1-2時間の完全セットアップ

### Q: 問題が発生した場合、ロールバックできますか？
**A:** はい。バックアップから復元するか、即座に簡略化するために`settings-minimal.json`を使用してください。

### Q: すべての新機能が必要ですか？
**A:** いいえ。ほとんどのユーザーは価値の80%を得るために機能の20%しか必要としません。小さく始めてください。

### Q: 既存のエージェント（Planner/Builder）は引き続き機能しますか？
**A:** はい。v2.5.0はコア動作を変更することなく、それらを強化します。

### Q: 私のカスタムフックとスクリプトはどうなりますか？
**A:** 互換性があります。新しいフックは置き換えではなく追加です。

### Q: 並列実行機能は安定していますか？
**A:** はい、ただしオプションです。並列化の恩恵を受けるタスクがある場合のみ有効にしてください。

### Q: どの機能を採用すべきかどうやって分かりますか？
**A:** 最小構成から始めてください。より多くの自動化が欲しいと感じたら、徐々に機能を有効にしてください。

---

## 🎯 成功の指標

移行が成功したことを知る方法：
- ✅ 基本コマンドが機能する（`/agent:planner`、`/agent:builder`）
- ✅ 引き継ぎドキュメントが自動生成される
- ✅ 危険なコマンドがブロックされる
- ✅ ワークフローがより複雑ではなく、よりスムーズに感じる

---

## 以前のバージョンの詳細

### v2.4.0 → v2.0.0 への移行

#### ステップ 1: Agent-Firstシステムの更新
```bash
# settings.jsonをステージガードで更新
# システムは自動的に適切な開発フローを強制します
```

#### ステップ 2: セキュリティ強化の適用
```bash
# 強化されたセキュリティシステムをテスト
.claude/scripts/test-security.sh
# 危険なコマンドの100%ブロックを確認
```

#### ステップ 3: 共有ユーティリティの活用
```bash
# 新しいスクリプトでshared-utils.shを使用
source .claude/scripts/shared-utils.sh
# コード重複を約30%削減
```

#### ステップ 4: Agent-Firstエントリーポイントの使用
```bash
# すべての新規開発を以下で開始：
/agent:first
# これにより最初から適切な方法論が保証されます
```

### v1.x → v2.0.0 への移行（レガシー）

#### ステップ 1: バックアップ
```bash
# 現在の設定をバックアップ
cp -r .claude .claude_backup_v1
cp CLAUDE.md CLAUDE_backup_v1.md
```

### ステップ 2: 新しいエージェント構造の作成
```bash
# エージェントディレクトリの作成
mkdir -p .claude/agents
mkdir -p .claude/planner/archive
mkdir -p .claude/builder/archive
mkdir -p .claude/shared

# active.mdの初期化
echo "# Active Agent\n\n## Current Agent: none\n\nLast updated: $(date +%Y-%m-%d)" > .claude/agents/active.md
```

### ステップ 3: 最新版の適用
```bash
# 最新版を取得
git pull origin main

# または手動でv2.0.0ファイルをコピー

# 日本語環境で使用する場合
mv .clauderules .clauderules_en     # 英語版を保存
mv .clauderules_ja .clauderules     # 日本語版を使用
```

### ステップ 4: コマンドの移行

#### 日常のワークフロー移行
```bash
# 以前のワークフロー
/project:plan      # 計画立案
/project:act       # 実装実行
/debug:start       # デバッグ
/review:check      # レビュー

# 新しいワークフロー
/agent:planner     # 計画・設計（新機能モード自動切り替え）
/agent:builder     # 実装・デバッグ・レビュー（モード自動切り替え）
```

#### カスタムコマンドの更新
もしカスタムコマンドを作成していた場合：
1. `.claude/commands/` を確認
2. 削除されたコマンドへの参照を更新
3. 新しいエージェントベースのフローに適応

### ステップ 5: CLAUDE.mdの更新
```bash
# CLAUDE.mdの主要セクションを更新
# - カスタムコマンドセクション
# - Claude Friendsシステムの説明を追加
# - 削除されたコマンドの記述を削除
```

### ステップ 6: 検証
```bash
# エージェント構造の確認
ls -la .claude/agents/
ls -la .claude/planner/
ls -la .claude/builder/

# コマンドの動作確認
# Plannerモードをテスト
"Please switch to planner mode"

# Builderモードをテスト  
"Please switch to builder mode"
```

### 以前のチェックリスト（v2.4.0）
- [ ] `/agent:first` コマンドが正常に動作する
- [ ] ステージ検証がアクティブ（要件なしでタスク作成を試す）
- [ ] セキュリティテストで100%ブロック率を表示
- [ ] 共有ユーティリティライブラリにアクセス可能
- [ ] ドキュメントの主張が正確性について検証済み


## 🆕 新機能の活用（v2.0.0）

### 1. スマートモード切り替え
```
Planner使用中：
「新しいユーザー認証機能を設計したい」
→ 自動的に新機能設計モードに切り替わり、Mermaid図を作成

Builder使用中：
エラーが発生
→ 自動的にデバッグモードに切り替わり、根本原因を分析
```

### 2. 引き継ぎシステム
```bash
# エージェント切り替え時
1. 現在のエージェントが handover.md を作成
2. 次のエージェントへの推奨事項を記載
3. スムーズな作業継続が可能
```

### 3. Phase/ToDo管理
```
# shared/phase-todo.md で一元管理
- 現在のPhase
- Phase内のToDo（優先順）
- 完了したPhase
- 次のPhase候補
```

### 以前のバージョンのよくある質問

#### Q: なぜコマンドが減ったのですか？（v2.0.0）
A: エージェントシステムが文脈を理解し、自動的に適切なモードに切り替わるため、個別のモードコマンドが不要になりました。

#### Q: 以前の `/debug:start` の機能はどこへ？
A: Builderエージェントがエラーを検出すると自動的にデバッグモードに入ります。手動で起動したい場合は「デバッグモードで分析して」と伝えるだけです。

#### Q: `/feature:plan` の詳細な設計書機能は？
A: Plannerエージェントに統合され、さらに強化されました。Mermaid図を自動的に含む、より視覚的な設計書を作成します。

#### Q: v2.0.0への移行にどれくらい時間がかかりますか？
A: 通常のプロジェクトなら30分程度で完了します。カスタマイズが多い場合は1時間程度を見込んでください。

#### Q: v1.xに戻すことはできますか？
A: バックアップから復元可能ですが、v2.0.0の利点（コスト削減、効率向上）を失うことになります。

## 🚀 移行後の新しいワークフロー例

```
朝の開始:
/agent:planner
「今日はユーザー管理機能を完成させたい」
→ Plannerが計画を立案、設計書を作成

実装開始:
/agent:builder  
「Plannerの設計に基づいて実装を開始」
→ Builderが実装、テスト、必要に応じてデバッグ

レビュー:
「実装したコードをレビューモードで確認して」
→ Builderが自動的にコードレビューモードに切り替え

日次振り返り:
/project:daily
→ どのエージェントからでも実行可能
```

## 📞 サポート

- **ドキュメント**: [Getting Started](GETTING_STARTED.md) | [README](README.md) | [CHANGELOG](CHANGELOG.md)
- **問題報告**: [GitHub Issues](https://github.com/sougetuOte/claude-friends-templates/issues)で報告
- **ベストプラクティス**: 小さく始めて、自然に成長させる

---

**覚えておいてください**: すべての機能を使用する必要はありません。最良の移行は、あなたを圧倒することなくワークフローを強化するものです。`settings-minimal.json`から始めて、ニーズに応じて機能を採用してください。🌱