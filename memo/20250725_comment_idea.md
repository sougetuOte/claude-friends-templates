# コメントルールに関する検討メモ

日付: 2025-07-25

## 現在のコメントルール

CLAUDE.mdに記載されている現在のルール：
```
# Code style
- IMPORTANT: DO NOT ADD ***ANY*** COMMENTS unless asked
```

つまり、ユーザーから明示的に要求されない限り、コメントは一切追加しないという方針。

## なぜこのルールができたか（推測）

1. **Clean Code の哲学**
   - 良いコードは自己文書化されている
   - コメントが必要なコードは、そもそもコードが分かりにくい

2. **コメントの腐敗問題**
   - コードは更新されてもコメントは更新されない
   - 古いコメントは誤解を招く

3. **AIツール特有の理由**
   - AIが自動生成するコメントは冗長になりがち
   - 自明なコメントを量産してしまう

## AI駆動開発における新しい視点

### 重要な気づき
「適切なコメントがコンポーネントやメソッドについていると、AIがそれらの実装の意図を間違いにくい」

### AI Friendly Comments の価値
- AIは実装の「意図」や「背景」を推測することが苦手
- 適切なコメントがあれば、AIの理解精度が大幅に向上
- 特にビジネスロジックや設計意図の説明は重要

### 良いコメントの例
```javascript
/**
 * ユーザーの購入履歴から推奨商品を計算する
 * 
 * ビジネスルール:
 * - 同じカテゴリの商品を3回以上購入したユーザーには関連商品を推奨
 * - 直近30日間の購入傾向を重視（重み付け: 0.7）
 * - 季節性を考慮（夏は冷感商品、冬は保温商品の重みを増やす）
 * 
 * @param userId - 対象ユーザーのID
 * @param options - 推奨オプション（カテゴリ絞り込み、除外商品など）
 * @returns 推奨商品リスト（最大10件、スコア降順）
 */
```

## コメントルール見直しの提案

### 新しいコメントガイドライン（案）

#### 1. 推奨するコメント
- なぜ（Why）この実装なのかの説明
- ビジネスルールや制約事項
- 将来のAI/開発者への意図の伝達
- 性能やセキュリティ上の考慮事項
- 一見不自然に見える実装の正当性

#### 2. 避けるべきコメント
- コードを日本語に翻訳しただけのもの
- 自明な処理の説明（`// iを1増やす`など）
- 更新されないリスクが高い詳細仕様
- whatの説明（コードを読めばわかること）

#### 3. コメント更新の義務
- コード変更時は関連コメントも必ず更新
- レビュー時にコメントの正確性も確認
- 古くなったコメントは削除

## コメントの新しい役割

従来：
- **人間→人間**: 複雑な部分の説明

AI時代：
- **人間→人間**: 複雑な部分の説明
- **人間→AI**: 意図と制約の明確化（NEW!）
- **AI→人間**: 生成したコードの根拠説明

## Vibe Logger との関連

実装済みのAI Logger（Vibe Logger準拠）の思想とも一致：
- 構造化された情報がAIの理解を助ける
- コンテキストが豊富なほどAIは正確に動作する
- デバッグだけでなく、コード理解にも同じ原理が適用できる

## 今後の検討事項

1. **実装方針の決定**
   - 現行ルールを維持するか
   - AI Friendly な新ルールに移行するか
   - 段階的な移行を行うか

2. **具体的なガイドライン作成**
   - どのような場合にコメントを書くべきか
   - コメントのフォーマット標準
   - 各言語での具体例

3. **ツールとの統合**
   - ESLint/Prettier などでのコメント規約
   - AIツールでのコメント生成ルール
   - コメント更新チェックの自動化

4. **チームへの展開**
   - 新ルールの説明と合意形成
   - 移行期間の設定
   - 効果測定の方法

## 参考リンク
- [Clean Code](https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882)
- [The Art of Readable Code](https://www.amazon.com/Art-Readable-Code-Practical-Techniques/dp/0596802293)
- Vibe Logger: AI駆動開発のためのロギングシステム

---
## 実装状況
- ✅ 2025-07-25: AI-Friendlyコメントガイドライン実装完了
- 実装内容:
  - `.claude/shared/ai-friendly-comments.md` - コメントガイドライン
  - `.claude/guidelines/ai-friendly-development.md` - 開発ガイドライン（英語）
  - `.claude/guidelines/ai-friendly-development_ja.md` - 開発ガイドライン（日本語）
  - `.claude/planner/identity.md` - Plannerエージェントへの統合
  - `.claude/builder/identity.md` - Builderエージェントへの統合